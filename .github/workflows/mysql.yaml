name: Combined Workflow

on:
  push:
    branches:
      - main

jobs:
  setup-mysql:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Start MySQL
        run: |
          sudo service mysql start
          sudo mysql -u root -proot -e "CREATE DATABASE IF NOT EXISTS actionsJava;"
          sudo mysql -u root -proot actionsJava < database.sql
        shell: bash

  java-ci:
    runs-on: ubuntu-latest
    needs: setup-mysql
    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up JDK 11
        uses: actions/setup-java@v2
        with:
          java-version: '11'
          distribution: 'adopt'

      - name: Compile and Test
        run: |
          javac Main.java
          java -cp .:mysql-connector-java-8.2.0.jar Main
